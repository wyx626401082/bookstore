<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xzsd.app.shoppingcart.dao.ShoppingCartDao">

    <!-- 统计商品数量 -->
    <select id="countGoodsNum" parameterType="java.lang.String" resultType="int">
        select count(goods_code)
        from t_sys_goods
        where is_deleted = 0
        and state = 1
    </select>

    <!-- 新增购物车 -->
    <insert id="addShoppingCart" parameterType="com.xzsd.app.shoppingcart.entity.ShoppingCartDO">
        insert into t_shopping_cart
            (cart_code,
             user_code,
             goods_code,
             goods_number,
             is_deleted,
             create_time,
             create_by,
             modify_time,
             modify_by,
             version)
        values
            (#{shoppingCartId},
             #{userId},
             #{goodsId},
             #{goodsNumber},
             #{isDeleted},
             now(),
             #{createBy},
             now(),
             #{ModifyBy},
             0)
    </insert>

    <!-- 删除购物车 -->
    <update id="deleteShoppingCart" parameterType="java.lang.String">
        update t_shopping_cart
        set is_deleted = 1,
            modify_by = #{userId},
            modify_time = now(),
            version = version + 1
        where cart_code in
        <foreach item="item" index="index" collection="listId" open="(" separator="," close=")">
            #{item}
        </foreach>
    </update>

    <!-- 修改购物车商品数量 -->
    <update id="updateShoppingCart" parameterType="com.xzsd.app.shoppingcart.entity.ShoppingCartDO">
        update t_shopping_cart
        set goods_number = #{goodsNumber},
            modify_by = #{modifyBy},
            modify_time = now(),
            version = version + 1
        where cart_code = #{shoppingCartId}
        and is_deleted = 0
    </update>

    <!-- 查询购物车列表 -->
    <select id="listShoppingCartByPage" parameterType="com.xzsd.app.shoppingcart.entity.ShoppingCartDO" resultType="com.xzsd.app.shoppingcart.entity.ShoppingCartVO">
        select
            ts.cart_code shoppingCartId,
            ts.goods_code goodsId,
            ts.goods_number goodsNumber,
            tg.goods_name goodsName,
            tg.goods_price goodsPrice,
            tg.goods_image goodsUrl
        from t_shopping_cart ts
        left join t_sys_goods tg on ts.goods_code = tg.goods_code
        where ts.is_deleted = 0
        and tg.is_deleted = 0
        and ts.user_code = #{userId}
        order by ts.create_time desc
    </select>
</mapper>